# 商品ドメインのクラス図
<div class="mermaid">

classDiagram
%% プレゼンテーション層
class ProductController {
  +ProductService productService
  +getAllProducts()
  +getProductById(productId)
}

%% サービス層
class ProductService {
  +ProductRepository productRepo
  +findAll()
  +findById(productId)
}

%% データアクセス層
class ProductRepository {
  +findAll(): List~Product~
  +findById(id)
}

%% ドメインモデル
class Product {
  +string productId
  +string name
  +text description
  +text material
  +decimal price
  +int stockQuantity
  +LocalDateTime createdAt
  +LocalDateTime updatedAt
}
class ProductImage {
  +string imageId
  +string productId
  +string imageUrl
  +int displayOrder
  +Boolean isMain
}

%% リレーション
ProductController --> ProductService
ProductService --> ProductRepository
ProductRepository --> Product
Product --> ProductImage

</div>


# カートドメインのクラス図
<div class="mermaid">
classDiagram
%% プレゼンテーション層
class CartController {
  +CartService cartService
  +getCart(sessionId)
  +addItem(sessionId, productId, quantity)
  +updateItem(sessionId, cartItemId, quantity)
  +removeItem(sessionId, cartItemId)
}

%% サービス層
class CartService {
  +CartRepository cartRepo
  +ProductRepository productRepo
  +getOrCreateCart(sessionId)
  +addItem(...)
  +updateItem(...)
  +removeItem(...)
  +calculateTotal()
}

%% データアクセス層
class CartRepository {
  +findBySessionId(sessionId)
  +save(cart)
}

%% ドメインモデル
class Cart {
  +string cartId
  +string sessionId
  +LocalDateTime createdAt
  +LocalDateTime updatedAt
  +List~CartItem~ items
}
class CartItem {
  +string cartItemId
  +Product product
  +int quantity
}

%% リレーション
CartController --> CartService
CartService --> CartRepository
CartService --> ProductRepository
CartRepository --> Cart
Cart --> CartItem
CartItem --> Product

</div>

# 注文ドメインのクラス図
<div class="mermaid">
classDiagram
%% プレゼンテーション層
class OrderController {
  +OrderService orderService
  +confirmOrder(sessionId, purchaserInfo)
  +placeOrder(sessionId, purchaserInfo)
}

%% サービス層
class OrderService {
  +OrderRepository orderRepo
  +CartRepository cartRepo
  +ProductRepository productRepo
  +createOrder(sessionId, purchaserInfo)
}

%% データアクセス層
class OrderRepository {
  +save(order)
}

%% ドメインモデル
class Order {
  +string orderId
  +string customerId    // 会員または NULL
  +string guestName
  +string guestEmail
  +string guestAddress
  +string guestPhone
  +decimal totalAmount
  +decimal shippingFee
  +LocalDateTime orderDate
  +string orderStatus
  +List~OrderItem~ items
}
class OrderItem {
  +string orderItemId
  +Product product
  +int quantity
  +decimal itemPrice
}

%% リレーション
OrderController --> OrderService
OrderService --> OrderRepository
OrderService --> CartRepository
OrderService --> ProductRepository
OrderRepository --> Order
Order --> OrderItem
OrderItem --> Product

</div>

# 会員登録・認証ドメインのクラス図
<div class="mermaid">
classDiagram
%% プレゼンテーション層
class AuthController {
  +AuthService authService
  +register(customerInfo)
  +login(email, password)
}

%% サービス層
class AuthService {
  +CustomerRepository customerRepo
  +register(...)
  +login(...)
}

%% データアクセス層
class CustomerRepository {
  +findByEmail(email)
  +save(customer)
}

%% ドメインモデル
class Customer {
  +string customerId
  +string name
  +string email
  +string passwordHash
  +string shippingAddress
  +string phoneNumber
  +LocalDateTime createdAt
  +LocalDateTime updatedAt
}

%% リレーション
AuthController --> AuthService
AuthService --> CustomerRepository
CustomerRepository --> Customer

</div>

# 商品（修正）
<div class="mermaid">
classDiagram
%% プレゼン層
class ProductController {
  +ProductService productService
  +getAllProducts()
  +getProductById(productId)
}

%% サービス層
class ProductService {
  +ProductRepository productRepo
  +findAll()
  +findById(productId)
}

%% データアクセス層
class ProductRepository {
  +findAll(): List~Product~
  +findById(id)
}

%% ドメインモデル
class Product {
  +string productId
  +string name
  +text description
  +text material
  +decimal price
  +int stockQuantity
  +LocalDateTime createdAt
  +LocalDateTime updatedAt
}
class ProductImage {
  +string imageId
  +string productId
  +string imageUrl
  +int displayOrder
  +Boolean isMain
}

%% リレーション（メソッド名・役割名付き）
ProductController --> ProductService : getAllProducts(), getProductById()
ProductService --> ProductRepository : findAll(), findById()
ProductRepository --> Product : loadProduct()
Product --> ProductImage : hasImages

</div>

# 型（商品）
<div class="mermaid">
classDiagram

%% プレゼンテーション層
class ProductController {
  +ProductService productService
  +getAllProducts(): List~ProductListItem~
  +getProduct(productId): ProductDetail
}

%% サービス層
class ProductService {
  +ProductRepository productRepository
  +findAll(): List~ProductListItem~
  +findById(productId): ProductDetail
}

%% データアクセス層
class ProductRepository {
  +findAll(): List~Product~
  +findById(productId): Optional~Product~
}

%% ドメインモデル
class Product {
  +Integer productId
  +String name
  +String description
  +Integer price
  +Integer stock
  +String imageUrl
  +Boolean isRecommended
}

%% DTO
class ProductListItem {
  +Integer productId
  +String name
  +Integer price
  +String imageUrl
}

class ProductDetail {
  +Integer productId
  +String name
  +String description
  +Integer price
  +Integer stock
  +String imageUrl
}

%% 関係
ProductController --> ProductService
ProductService --> ProductRepository
ProductService ..> ProductListItem : creates
ProductService ..> ProductDetail : creates
ProductRepository --> Product

</div>


# 商品
<div class="mermaid">
classDiagram

%% プレゼンテーション層
class ProductController {
  +ProductService productService
  +getAllProducts(): List~ProductListItem~
  +getProduct(productId): ProductDetail
}

%% サービス層
class ProductService {
  +ProductRepository productRepository
  +findAll(): List~ProductListItem~
  +findById(productId): ProductDetail
}

%% データアクセス層
class ProductRepository {
  +findAll(): List~Product~
  +findById(productId): Optional~Product~
}

%% ドメインモデル
class Product {
  +Integer productId
  +String name
  +String description
  +Integer price
  +Integer stock
  +String imageUrl
  +Boolean isRecommended
}

%% DTO
class ProductListItem {
  +Integer productId
  +String name
  +Integer price
  +String imageUrl
}

class ProductDetail {
  +Integer productId
  +String name
  +String description
  +Integer price
  +Integer stock
  +String imageUrl
}

%% 関係（操作名・役割名）
ProductController --> ProductService : uses getAllProducts(), getProduct()
ProductService --> ProductRepository : calls findAll(), findById()
ProductService ..> ProductListItem : creates DTO
ProductService ..> ProductDetail : creates DTO
ProductRepository --> Product : loads data

</div>