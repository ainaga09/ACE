# オンライン販売サイト（ECサイト） 基本設計書

| ドキュメントバージョン | 1.0                                    |
| :------------------- | :------------------------------------- |
| 作成日               | 2025年7月2日                           |
| 作成チーム           |Ace                               |
| 承認者               | 木山さん                             |
| 更新履歴             |  |

---

## 1. はじめに

### 1.1. 本書の目的

本書は、株式会社〇〇が開発を進める「オンライン販売サイト（ECサイト）」新規構築プロジェクトにおける基本設計の内容を定義するものである。要件定義書で定められた要件に基づき、システムの全体構成、主要な機能、画面、データ、非機能要件への対応方針などを明確にし、後続の詳細設計、実装、テスト工程のインプットとすることを目的とする。

### 1.2. プロジェクト概要
- 株式会社〇〇はこれまで実店舗を中心に雑貨（文房具、キッチン小物など）の販売を行ってきたが、販路は地域に限定されていた。  
- SNS（Instagram等）を活用して商品紹介や個別問い合わせ対応による販売も行っているが、受注処理や問い合わせ対応に手間がかかり、業務の効率性に課題がある。  
- 競合他社がオンライン販売チャネルを拡大しており、遠方の潜在顧客からも購買希望が寄せられている。

以上の課題を解決し、販路の拡大と受注業務を効率化することを目的とする。

### 1.3. 前提知識

本書を読むにあたり、以下の知識を有していることを前提とする。

- 本プロジェクトの要件定義書の内容
- ECサイト開発の基本的な知識 (HTTP, HTML, CSS, JavaScript)
- REST API の基本的な概念
- Java および Spring Boot フレームワークの基本的な知識
- リレーショナルデータベースの基本的な知識

<div class="mermaid">
classDiagram
    ProductController --> ProductService : uses
    ProductService --> ProductRepository : uses
    ProductRepository -- Product : manages

    ProductService ..> ProductDetail : creates
    ProductService ..> ProductListItem : creates
    ProductController ..>ProductDetail : returns
    ProductController ..> ProductListItem : returns
    

    class ProductController {
        +ProductService productService
        +getAllProducts():ResponseEntity~List~ProductListItem~~
        +getProductById(String productId):ResponseEntity~ProductDetail~
    }
    class ProductService {
        +ProductRepository productRepository
        +findAllProducts():List<Product> 
        +findProductById(String productId):Product 
        +updateStock(String productId, int quantityChange):void 
    }
    class ProductRepository {
        +JpaRepository~Product, Integer~
        +findAll():List<Product> 
        +findById(String productId):Optional<Product> 
        +save(Product product):Product 
        +updateStockQuantity(String productId, int newQuantity):void 
    }
    class Product {
        +String productId
        +String productName
        +String description
        +String material
        +Decimal price
        +string imageurl
        +int stockQuantity
        +LocalDateTime createdAt
        +LocalDateTime updatedAt
    }
   
    class ProductDetail{
        +String productId
        +String productName
        +String description
        +String material
        +Decimal price
        +string imageurl
        +int stockQuantity
        
    }
    class ProductListItem{
        +String productId
        +String productName
        +string imageurl
        +Decimal price
        
    }
</div>

<div class="mermaid">
classDiagram
    OrderController --> OrderService : uses
    OrderService --> OrderRepository : uses
    OrderService --> OrderItemRepository : uses
    OrderService --> ProductRepository : uses
    OrderService ..> CustomerRepository : uses (for logged-in users)

    OrderRepository -- Order : manages
    OrderItemRepository -- OrderItem : manages
    ProductRepository -- Product : manages
    CustomerRepository -- Customer : manages

    Order o-- OrderItem : includes
    OrderItem --> Product : refers to
    Order ..> Customer : placed by (optional for guest)

    class OrderController {
        +OrderService orderService
        +confirmOrder(OrderRequestDTO request):ResponseEntity<OrderConfirmationDTO> 
        +placeOrder(OrderRequestDTO request):ResponseEntity<OrderCompletionDTO> 
    }
    class OrderService {
        +OrderRepository orderRepository
        +OrderItemRepository orderItemRepository
        +ProductRepository productRepository
        +CustomerRepository customerRepository
        // -CartService cartService // カートサービスへの依存も考えられる
        +createOrder(Cart cart, Customer customer, ShippingInfo shippingInfo):Order 
        +createGuestOrder(Cart cart, GuestInfo guestInfo):Order 
        +processOrderPayment(String orderId):void 
        +sendOrderConfirmationEmail(String orderId):void 
    }
    class OrderRepository {
        +JpaRepository~Order, Integer~
        +save(Order order):Order 
        +findById(String orderId):Optional<Order> 
    }
    class OrderItemRepository {
        +JpaRepository~Order, Integer~
        +save(OrderItem item):OrderItem 
        +findByOrderId(String orderId):List<OrderItem> 
    }
    class ProductRepository {
        +JpaRepository~Product, Integer~
        +findById(String productId):Optional<Product> 
        +updateStockQuantity(String productId, int newQuantity):void 
    }
    class CustomerRepository {
        +JpaRepository~Customer, Integer~
        +findById(String customerId):Optional<Customer> 
    }
    class Order {
        +String orderId
        +String customerId
        +String guestName
        +String guestEmail
        +String guestShippingAddress
        +String guestPhoneNumber
        +BigDecimal totalAmount
        +BigDecimal shippingFee
        +LocalDateTime orderDate
        +String orderStatus
        +List<OrderItem> orderItems
        +calculateTotal()
    }
    class OrderItem {
        +String orderItemId
        +String orderId
        +String productId
        +int quantity
        +BigDecimal itemPrice
        +String productName
    }
    class Product {
        +String productId
        +String productName
        +BigDecimal price
        +int stockQuantity
    }
    class Customer {
        +String customerId
        +String customerName
        +String email
    }
</div>

<div class="mermaid">
classDiagram
 
%% === エンティティ ===
class Cart {
    <<Entity>>
    +cartId: String
    +sessionId: String
    +createdAt: LocalDateTime
    +updatedAt: LocalDateTime
}
 
class CartItem {
    <<Entity>>
    +cartItemId: String
    +cartId: String
    +productId: String
    +quantity: int
    +priceAtAddition: BigDecimal
    +createdAt: LocalDateTime
    +updatedAt: LocalDateTime
}
 

%% === DTO / 入力モデル ===
class CartDto {
    +cartId: String
    +items: List~CartItemDto~
    +totalPrice: BigDecimal
}
 
class CartItemDto {
    +productId: String
    +name: String
    +quantity: int
    +price: BigDecimal
}
 
class CartItemInfo {
    +productId: String
    +quantity: int
}
 
class CartItemQuantityDto {
    +quantity: int
}
 
%% === コントローラ層 ===
class CartController {
    -cartService: CartService
    -sessionManager: SessionManager
    +getCart(request: HttpRequest): ResponseEntity~CartDto~ 
    +addItem(itemInfo: CartItemInfo, request: HttpRequest): ResponseEntity~CartDto~
    +updateItem(itemId: String, quantityDto: CartItemQuantityDto, request: HttpRequest): ResponseEntity~CartDto~
    +removeItem(itemId: String, request: HttpRequest): ResponseEntity~CartDto~
}
 
class SessionManager {
    +getSessionId(request: HttpRequest): String
}
 
%% === サービス層 ===
class CartService {
    -cartRepository: CartRepository
    -cartItemRepository: CartItemRepository
    -productRepository: ProductRepository
    +getOrCreateCart(sessionId: String): Cart
    +addItemToCart(sessionId: String, cartItemInfo: CartItemInfo): Cart
    +updateItemQuantity(sessionId: String, itemId: String, quantity: int): Cart
    +removeItemFromCart(sessionId: String, itemId: String): Cart
}
 
%% === Repository層 ===
class CartRepository {
    -jpaRepository: JpaRepository~Cart, String~
    +findBySessionId(sessionId: String): Optional~Cart~
    +findById(cartId: String): Optional~Cart~
    +save(cart: Cart): Cart
}
 
class CartItemRepository {
    -jpaRepository: JpaRepository~CartItem, String~
    +findByCartId(cartId: String): List~CartItem~
    +save(cartItem: CartItem): CartItem
    +deleteById(cartItemId: String): void
    +deleteByCartId(cartId: String): void
}
 
 
 
%% === 関係 ===
CartController --> SessionManager : uses
CartController --> CartService : uses
CartController ..> CartDto : returns
CartController ..> CartItemInfo : receives
CartController ..> CartItemQuantityDto : receives
CartController ..> HttpRequest : receives
 
CartService --> CartRepository : uses
CartService --> CartItemRepository : uses
CartService --> ProductRepository : uses
 
CartRepository ..> Cart : manages
CartItemRepository ..> CartItem : manages
 
 
Cart "1" -- "*" CartItem : contains
CartDto "1" -- "*" CartItemDto : contains
 
 
</div>


<div class="mermaid">
classDiagram
    CustomerController --> CustomerService : uses
    CustomerService --> CustomerRepository : uses
    CustomerRepository -- Customer : manages

    class CustomerController {
        +CustomerService customerService
        +registerCustomer(CustomerRegistrationRequest request):ResponseEntity<CustomerRegistrationResponse> 
        +login(LoginRequest request):ResponseEntity<LoginResponse> 
    }
    class CustomerService {
        +CustomerRepository customerRepository
        // -PasswordEncoder passwordEncoder // パスワードエンコードのための依存など
        +registerCustomer(String name, String email, String password, String address, String phone):Customer 
        +authenticate(String email, String password)
        +Customer getCustomerInfo(String customerId):Optional<Customer> 
         
    }
    class CustomerRepository {
        +JpaRepository~Customer, Integer~
        +save(Customer customer):Customer 
        +findById(String customerId):Optional<Customer> 
        +findByEmail(String email):Optional<Customer> 
        +delete(String customerId):void 
    }
    class Customer {
        +String customerId
        +String customerName
        +String email
        +String passwordHash
        +String shippingAddress
        +String phoneNumber
        +LocalDateTime createdAt
        +checkPassword(String rawPassword):boolean 
        
    }
</div>