<div class="mermaid">
sequenceDiagram
    participant ユーザー
    participant フロントエンド
    participant OrderController
    participant OrderService
    participant ProductRepository
    participant OrderRepository

    ユーザー->>フロントエンド: 商品一覧表示要求
    フロントエンド->>OrderController: getAllProducts()要求
    OrderController->>ProductRepository: findAll()呼び出し
    ProductRepository-->>OrderController: 商品一覧返却
    OrderController-->>フロントエンド: 商品一覧返却
    フロントエンド-->>ユーザー: 商品一覧表示

    ユーザー->>フロントエンド: 商品詳細表示要求
    フロントエンド->>OrderController: getProduct(productId)要求
    OrderController->>ProductRepository: findById(productId)呼び出し
    ProductRepository-->>OrderController: 商品詳細返却
    OrderController-->>フロントエンド: 商品詳細返却
    フロントエンド-->>ユーザー: 商品詳細表示

    ユーザー->>フロントエンド: 商品をカートに追加
    フロントエンド-->>ユーザー: カートに追加完了表示

    ユーザー->>フロントエンド: 購入手続きへ進む要求
    フロントエンド-->>ユーザー: 購入確認画面表示

    alt ログインする
        ユーザー->>フロントエンド: ログイン情報入力
        フロントエンド->>OrderController: login()呼び出し
        OrderController->>OrderService: ログイン処理依頼
        OrderService-->>OrderController: ログイン成功・個人情報取得
        OrderController-->>フロントエンド: 個人情報返却
        フロントエンド-->>ユーザー: 個人情報自動入力
    else ログインしない
        ユーザー->>フロントエンド: 購入者情報を手動入力
    end

    フロントエンド->>OrderController: 注文処理依頼（注文情報送信）
    OrderController->>OrderService: 注文登録処理依頼
    OrderService->>OrderRepository: 注文データ保存
    OrderRepository-->>OrderService: 保存完了
    OrderService-->>OrderController: 注文受付完了
    OrderController-->>フロントエンド: 注文受付完了通知
    フロントエンド-->>ユーザー: 注文完了通知
</div>